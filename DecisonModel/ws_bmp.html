<!DOCTYPE html>
<script src="http://serverapi.arcgisonline.com/jsapi/arcgis/3.4/"></script>
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript">
	var map;
	var hrulayer_id;//global sequence id to assign to hru layers
	function displayMap() {

		if (typeof (map) != "undefined") {
			map.destroy("map");
		}

		//initialize sequence id for hru layers
		hrulayer_id = 0;

		//remove all options from the select element
		document.getElementById("subbasin_id").options.length = 0;
		var optn = document.createElement("OPTION");
		optn.text = "---";
		optn.value = "default";
		document.getElementById("subbasin_id").options.add(optn);
		//end here

		//remove all elements from selected subbasins list and the hidden select for the subbasins
		//document.getElementById("selected_subbasins").options.length = 0;
		//document.getElementById("selected_subbasin_temp").options.length = 0;
		document.getElementById("hruIDs_temp").options.length = 0;
		document.getElementById("selected_subbasin_bmp").options.length = 0;
		document.getElementById("selected_subbasins").options.length = 0;

		//set the cost for BMPs to zero
		document.getElementById("bmp_cost").value = "";
		for ( var i = 1; i < document.getElementById("selected_bmps").options.length; i++) {
			document.getElementById("selected_bmps").options[i].value = "0";
		}

		//remove the hru_info div element
		var hru_info_div = document.getElementById("hru_info");
		while (hru_info_div.hasChildNodes()) {
			hru_info_div.removeChild(hru_info_div.lastChild);
		}

		if (document.getElementById("wstype").value == "default") {
			return;
		}

		require(
				[ "esri/map", "esri/layers/FeatureLayer", "dojo/domReady!" ],
				function() {
					var ws_url;
					var rch_url;
					var hru_url;
					var subbasin_label_url;
					var mapserver_url;
					var bounds;

					//decide the extent for each map
					if (document.getElementById("wstype").value == "blc") {
						bounds = new esri.geometry.Extent({
							"xmin" : -9894100.49722937,
							"ymin" : 4823500.2917971,
							"xmax" : -9879214.17921767,
							"ymax" : 4847453.47319821,
							"spatialReference" : {
								"wkid" : 102100
							}
						});
					} else if (document.getElementById("wstype").value == "bd") {
						bounds = new esri.geometry.Extent({
							"xmin" : -9818868.92396209,
							"ymin" : 4915761.00783883,
							"xmax" : -9814803.41427354,
							"ymax" : 4919377.28252372,
							"spatialReference" : {
								"wkid" : 102100
							}
						});
					}
					//decide the extent for each map end here

					//create a map instance
					map = new esri.Map("map", {
						extent : bounds
					});

					//create an ArcGISDynamicMapServiceLayer instance for rendering "water shed" and "reach" layers
					mapserver_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer";
					var imageParameters = new esri.layers.ImageParameters();
					imageParameters.format = "jpeg";
					var map_layers = new esri.layers.ArcGISDynamicMapServiceLayer(
							mapserver_url, {
								"imageParameters" : imageParameters
							});

					if (document.getElementById("wstype").value == "blc") {
						ws_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/2";
						//rch_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/0";
						//subbasin_label_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer";
						hru_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/3";
						map_layers.setVisibleLayers([ 2, 0, 1 ]);
					} else if (document.getElementById("wstype").value == "bd") {
						ws_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/6";
						//rch_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/4";				
						//subbasin_label_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer";
						hru_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/7";
						map_layers.setVisibleLayers([ 6, 4, 5 ]);
					}

					//create a featurelayer for rendering "hru" layer
					//var hru_layer = new esri.layers.FeatureLayer(hru_url);						  
					//hru_layer.setDefinitionExpression("HRU_ID IN (4,2,7,20,21,24,40,41,42)");

					//add the layers to the map
					//map.addLayer(hru_layer);
					map.addLayer(map_layers);

					//query the subbasin IDs when the map is chosen
					var queryTask = new esri.tasks.QueryTask(ws_url);
					var query = new esri.tasks.Query();
					query.returnGeometry = false;
					query.where = "1=1";
					query.outFields = [ "Subbasin" ];
					queryTask
							.execute(
									query,
									function(objectIds) {
										var i;
										for (i = 0; i < objectIds.features.length; i++) {
											var featureAttributes = objectIds.features[i].attributes;
											var optn = document
													.createElement("OPTION");
											optn.text = featureAttributes["Subbasin"];
											optn.value = featureAttributes["Subbasin"];
											document
													.getElementById("subbasin_id").options
													.add(optn);
										}
										document.getElementById("subbasin_id").options.selectedIndex = 0;
									},
									function(errorMsg) {
										alert("Error while fetching Subbasin IDs:"
												+ errorMsg);
									});

					if (document.getElementById("wstype").value == "blc") {
						//var point = new esri.geometry.Point(-9892000, 4834700, new esri.SpatialReference({ wkid: 102100 }));
						//map.centerAndZoom(point,1.05);
						map.setLevel(-1);
					} else if (document.getElementById("wstype").value == "bd") {
						//var point = new esri.geometry.Point(-9816000, 4913700, new esri.SpatialReference({ wkid: 102100 }));
						//map.centerAndZoom(point,5.5);
						map.setLevel(6);
					}

				});
	}

	function addSubbasin() {
		var i;
		var hru_url;
		if (document.getElementById("subbasin_id").value == "default"
				|| document.getElementById("subbasin_area").value == "0") {
			alert("Select a Subbasin and Area for BMP.");
			return;
		}

		//validation to check for already selected subbasin
		for (i = 0; i < document.getElementById("selected_subbasin_temp").options.length; i++) {
			if (document.getElementById("subbasin_id").value == document
					.getElementById("selected_subbasin_temp").options[i].value) {
				alert("Subbasin is already selected for BMP.");
				return;
			}
		}

		//select the hru_url based on watershed type
		if (document.getElementById("wstype").value == "blc") {
			hru_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/3";
		} else if (document.getElementById("wstype").value == "bd") {
			hru_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/7";
		}

		//get hru ids in the selected subbasin
		require(
				[ "esri/map", "esri/layers/FeatureLayer", "dojo/domReady!" ],
				function() {
					var hru_ids;
					var queryTask = new esri.tasks.QueryTask(hru_url);
					var query = new esri.tasks.Query();
					query.returnGeometry = false;
					//query.where = "HRU_FR <= " + ((document.getElementById("subbasin_area").value)/100) + " AND SUBBASIN = " +document.getElementById("subbasin_id").value;
					query.where = "SUBBASIN = "
							+ document.getElementById("subbasin_id").value;
					query.outFields = [ "HRU_ID", "HRU_FR" ];
					queryTask
							.execute(
									query,
									function(objectIds) {
										var i;
										hru_ids = "";
										for (i = 0; i < objectIds.features.length; i++) {
											var featureAttributes = objectIds.features[i].attributes;
											if (i != objectIds.features.length - 1) {
												hru_ids = hru_ids
														+ featureAttributes["HRU_ID"]
																.toString()
														+ ",";
											} else {
												hru_ids = hru_ids
														+ featureAttributes["HRU_ID"]
																.toString();
											}
											//alert(typeof(featureAttributes["HRU_ID"]));
										}
										//create a featurelayer for rendering "hru" layer
										var hru_layer = new esri.layers.FeatureLayer(
												hru_url, {
													id : ++hrulayer_id
												});
										hru_layer
												.setDefinitionExpression("HRU_ID IN ("
														+ hru_ids + ")");
										//add the layer to the map
										map.addLayer(hru_layer);

										//a new subbasin is selected, add to the list
										var optn = document
												.createElement("OPTION");
										optn.text = "Subbasin ID - "
												+ document
														.getElementById("subbasin_id").value
												+ " : "
												+ document
														.getElementById("subbasin_area").value
												+ " %"
										optn.value = hrulayer_id;
										document
												.getElementById("selected_subbasins").options
												.add(optn);
										//the new subbasin id is also added to the temp list which is hidden in the html
										var optn_temp = document
												.createElement("OPTION");
										optn_temp.text = document
												.getElementById("subbasin_id").value;
										optn_temp.value = document
												.getElementById("subbasin_id").value;
										document
												.getElementById("selected_subbasin_temp").options
												.add(optn_temp);
										//the new hru layer id is also added to the temp list which is hidden in the html
										/*var optn_temp = document.createElement("OPTION");
										optn_temp.text = hrulayer_id;
										optn_temp.value = hrulayer_id;
										document.getElementById("selected_subbasin_hrulayerID").options.add(optn_temp);*/

									},
									function(errorMsg) {
										alert("Error while fetching Subbasin IDs:"
												+ errorMsg);
									});
				});
	}

	function removeSubbasin() {
		var i;
		var hru_url;
		if (document.getElementById("selected_subbasins").options.length == 0) {
			alert("Please Add Subbasins for BMP");
			return;
		}
		for (i = 0; i < document.getElementById("selected_subbasins").options.length; i++) {
			if (document.getElementById("selected_subbasins").options[i].selected) {
				var hru_layer_id = document
						.getElementById("selected_subbasins").options[i].value;
				document.getElementById("selected_subbasins").remove(i);
				document.getElementById("selected_subbasin_temp").remove(i);

				//select the hru_url based on watershed type
				if (document.getElementById("wstype").value == "blc") {
					hru_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/3";
				} else if (document.getElementById("wstype").value == "bd") {
					hru_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/7";
				}

				//create a featurelayer for rendering "hru" layer
				var hru_layer = map.getLayer(hru_layer_id);
				//remove the layer from the map
				map.removeLayer(hru_layer);
			}
		}
	}

	function displayHruIDs() {
		var hru_url;
		var i;

		//just make sure to clear the temp list hruIDs
		document.getElementById("hruIDs_temp").options.length = 0;

		//remove the hru_info div element
		var hru_info_div = document.getElementById("hru_info");
		while (hru_info_div.hasChildNodes()) {
			hru_info_div.removeChild(hru_info_div.lastChild);
		}

		if (document.getElementById("subbasin_id").value == "default") {
			return;
		}

		//validation to check for already selected subbasin
		for (i = 0; i < document.getElementById("selected_subbasin_temp").options.length; i++) {
			if (document.getElementById("subbasin_id").value == document
					.getElementById("selected_subbasin_temp").options[i].value) {
				alert("Subbasin "
						+ document.getElementById("subbasin_id").value
						+ " is already selected for BMP.");
				document.getElementById("subbasin_id").value = "default";
				return;
			}
		}

		//select the hru_url based on watershed type
		if (document.getElementById("wstype").value == "blc") {
			hru_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/3";
		} else if (document.getElementById("wstype").value == "bd") {
			hru_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/7";
		}

		//get hru ids in the selected subbasin
		require(
				[ "esri/map", "esri/layers/FeatureLayer", "dojo/domReady!" ],
				function() {
					var hru_ids;
					var queryTask = new esri.tasks.QueryTask(hru_url);
					var query = new esri.tasks.Query();
					query.returnGeometry = false;
					query.where = "SUBBASIN = "
							+ document.getElementById("subbasin_id").value;
					query.outFields = [ "HRU_ID", "HRU_FR" ];
					queryTask
							.execute(
									query,
									function(objectIds) {
										var i;
										//hru_ids = "";
										var hru_info_div = document
												.getElementById("hru_info");
										while (hru_info_div.hasChildNodes()) {
											hru_info_div
													.removeChild(hru_info_div.lastChild);
										}
										for (i = 0; i < objectIds.features.length; i++) {
											var featureAttributes = objectIds.features[i].attributes;
											/*if(i != objectIds.features.length-1){
												hru_ids = hru_ids + featureAttributes["HRU_ID"].toString() + ",";
											}else{
												hru_ids = hru_ids + featureAttributes["HRU_ID"].toString();
											}*/
											//add the HRU as a checkbox						
											var checkbox = document
													.createElement("input");
											checkbox.setAttribute("type",
													"checkbox");
											checkbox.setAttribute("name", ""); //name is used to store the BMP assigned later for this HRU
											checkbox
													.setAttribute(
															"id",
															featureAttributes["HRU_ID"]); // stores the hru id
											checkbox
													.setAttribute(
															"value",
															featureAttributes["HRU_FR"]); // stores the fraction of subbasin area
											hru_info_div.appendChild(checkbox);

											//create labels for the HRU IDs
											var label = document
													.createElement('label')
											label.htmlFor = featureAttributes["HRU_ID"];
											label
													.appendChild(document
															.createTextNode("HRU "
																	+ featureAttributes["HRU_ID"]
																			.toString()
																	+ "("
																	+ Math
																			.floor(featureAttributes["HRU_FR"] * 100 * 100)
																	/ 100
																	+ "%)"));
											hru_info_div.appendChild(label);
											//add the HRU as a checkbox ends here

											//add the HRU IDs to a temp list
											var optn_temp = document
													.createElement("OPTION");
											optn_temp.text = featureAttributes["HRU_ID"];
											optn_temp.value = featureAttributes["HRU_ID"];
											document
													.getElementById("hruIDs_temp").options
													.add(optn_temp);
										}
									},
									function(errorMsg) {
										alert("Error while fetching Subbasin IDs:"
												+ errorMsg);
									});
				});

	}

	function assignBMP() {
		var i;

		if (document.getElementById("hruIDs_temp").options.length == 0) {
			alert("No HRUS selected for BMP");
			return;
		}
		if (document.getElementById("bmp").value == "default") {
			alert("Select a BMP");
			return;
		}

		area_fraction = 0;
		for (i = 0; i < document.getElementById("hruIDs_temp").options.length; i++) {
			var hru_id = document.getElementById("hruIDs_temp").options[i].value;
			if (!document.getElementById(hru_id).disabled
					&& document.getElementById(hru_id).checked) {
				//alert(document.getElementById(hru_id).name);
				document.getElementById(hru_id).setAttribute("name",
						document.getElementById("bmp").value);
				document.getElementById(hru_id).disabled = true;
				//alert(document.getElementById(hru_id).name);
				area_fraction = parseFloat(area_fraction)
						+ parseFloat(document.getElementById(hru_id).value);
				//alert(document.getElementById(hru_id).value);
			}
		}

		if (area_fraction == 0) {
			alert("Select HRUs for BMP");
			return;
		} else {

			alert(Math.floor(parseFloat(area_fraction) * 100 * 100)
					/ 100
					+ " % of Subbasin has been assigned "
					+ document.getElementById("bmp").options[document
							.getElementById("bmp").selectedIndex].text);
		}

	}

	function clearBMP() {
		var i;
		if (document.getElementById("hruIDs_temp").options.length == 0) {
			alert("No BMPs assigned for HRUs.");
			return;
		}
		var prompt = confirm("Do you want to reset BMPs selected for the HRUs ? All BMPs assigned for this subbasin will be lost!");
		if (prompt == true) {
			for (i = 0; i < document.getElementById("hruIDs_temp").options.length; i++) {
				var hru_id = document.getElementById("hruIDs_temp").options[i].value;
				document.getElementById(hru_id).setAttribute("name", "");
				document.getElementById(hru_id).disabled = false;
				document.getElementById(hru_id).checked = false;
			}
		}
	}

	function addSubbasinForBMP() {
		var i;
		var bmp_subbasin;
		var fraction_bmp = new Array();
		var hru_IDs; //collect hru_IDs for querying from map layer
		var hru_url;

		//intialize array indexes 1,2,3
		fraction_bmp[1] = 0;
		fraction_bmp[2] = 0;
		fraction_bmp[3] = 0;

		bmp_subbasin = "";
		for (i = 0; i < document.getElementById("hruIDs_temp").options.length; i++) {
			var hru_id = document.getElementById("hruIDs_temp").options[i].value;
			var bmp = document.getElementById(hru_id).name;
			var hru_fr = document.getElementById(hru_id).value;
			if (bmp != "") {
				if (bmp_subbasin == "") {
					bmp_subbasin = hru_id + "," + bmp;
					hru_IDs = hru_id;
				} else {
					bmp_subbasin = bmp_subbasin + ";" + hru_id + "," + bmp;
					hru_IDs = hru_IDs + "," + hru_id;
				}
				switch (bmp) {
				case "1":
					fraction_bmp[1] = parseFloat(fraction_bmp[1])
							+ parseFloat(hru_fr);
					break;
				case "2":
					fraction_bmp[2] = parseFloat(fraction_bmp[2])
							+ parseFloat(hru_fr);
					break;
				case "3":
					fraction_bmp[3] = parseFloat(fraction_bmp[3])
							+ parseFloat(hru_fr);
					break;
				}
			}
		}
		//alert(hru_IDs);
		if (bmp_subbasin == "") {
			alert("No BMPs are assigned for the subbasin!");
		} else {
			//select the hru_url based on watershed type
			if (document.getElementById("wstype").value == "blc") {
				hru_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/3";
			} else if (document.getElementById("wstype").value == "bd") {
				hru_url = "http://gismaps.sws.uiuc.edu/ArcGIS/rest/services/UpperSangBMP/MapServer/7";
			}

			//create a map layer for displaying selected HRUs
			require(
					[ "esri/map", "esri/layers/FeatureLayer", "dojo/domReady!" ],
					function() {
						var hru_layer = new esri.layers.FeatureLayer(hru_url, {
							id : ++hrulayer_id
						});
						hru_layer.setDefinitionExpression("HRU_ID IN ("
								+ hru_IDs + ")");
						//add the layer to the map
						map.addLayer(hru_layer);
					});

			//add the BMPs selected to the temp list
			var optn = document.createElement("OPTION");
			optn.text = bmp_subbasin;
			optn.value = bmp_subbasin;
			document.getElementById("selected_subbasin_bmp").options.add(optn);
			//ends here

			//add the BMPs selected to the selected subbasin list for display
			var optn_1 = document.createElement("OPTION");
			optn_1.text = "Subbasin "
					+ document.getElementById("subbasin_id").value + ": "
					+ "SB-"
					+ Math.floor(parseFloat(fraction_bmp[1]) * 100 * 100) / 100
					+ "% ," + "GW-"
					+ Math.floor(parseFloat(fraction_bmp[2]) * 100 * 100) / 100
					+ "% ," + "CW-"
					+ Math.floor(parseFloat(fraction_bmp[3]) * 100 * 100) / 100
					+ "%";
			optn_1.value = hrulayer_id; //save map layer id for this set of HRUs
			//also create the hru_layer and save the map layer id in the value attribute
			document.getElementById("selected_subbasins").options.add(optn_1);
			//ends here

			//the subbasin id is also added to the temp list which is hidden in the html
			var optn_2 = document.createElement("OPTION");
			optn_2.text = document.getElementById("subbasin_id").value;
			optn_2.value = document.getElementById("subbasin_id").value;
			document.getElementById("selected_subbasin_temp").options
					.add(optn_2);

			//delete the hru_info div element
			var hru_info_div = document.getElementById("hru_info");
			while (hru_info_div.hasChildNodes()) {
				hru_info_div.removeChild(hru_info_div.lastChild);
			}

			//reset the hruIDs_temp list as well
			document.getElementById("hruIDs_temp").options.length = 0;

			//add the selected BMPs to the cost list
			/*var bmp_selected = new Array();
			var bmp_in_list = new Array();
			for(i=1 ; i<4 ; i++){
				bmp_in_list[i] = "0";//intialize to 0 -> not selected
				if(parseFloat(fraction_bmp[i]) != 0) bmp_selected[i] = "1";  //set to 1 if the bmp is selected
				else bmp_selected[i] = "0";
			}
			
			for(i=0 ; i < document.getElementById("selected_bmps").options.length ; i++){
				var bmp = document.getElementById("selected_bmps").options[i].text;
				switch (bmp){
					case "Stream Buffer":
						bmp_in_list[1] = "1";
						break;
					case "Grassed Waterways":
						bmp_in_list[2] = "1";
						break;
					case "Constructed Wetland":
						bmp_in_list[3] = "1";
						break;
				}
			}
			
			for(i=1 ; i<4 ; i++){
				if(bmp_in_list[i] == "0" && bmp_selected[i] == "1"){
					var optn_3 = document.createElement("OPTION");
					switch (i){
						case "1":
							optn_3.text = "Stream Buffer";
							optn_3.value = "0";
							break;
						case "2":
							optn_3.text = "Grassed Waterways";
							optn_3.value = "0";
							break;
						case "3":
							optn_3.text = "Constructed Wetland";
							optn_3.value = "0";
							break;
					}
					document.getElementById("selected_bmps").options.add(optn_3);
				}
			}*/

			alert("Assigned BMPs for Subbasin "
					+ document.getElementById("subbasin_id").value
					+ " have been added");
		}
	}

	function removeSubbasinForBMP() {
		var i;
		var hru_url;
		if (document.getElementById("selected_subbasins").options.length == 0) {
			alert("Please Add Subbasins for BMP");
			return;
		}
		for (i = 0; i < document.getElementById("selected_subbasins").options.length; i++) {
			if (document.getElementById("selected_subbasins").options[i].selected) {
				//remove the map layer
				var hru_layer = map.getLayer(document
						.getElementById("selected_subbasins").options[i].value);
				//remove the layer from the map
				map.removeLayer(hru_layer);

				//remove from the lists
				document.getElementById("selected_subbasin_bmp").remove(i);
				document.getElementById("selected_subbasin_temp").remove(i);
				document.getElementById("selected_subbasins").remove(i);
				alert("Selected subbasin removed for BMP");
			}
		}
	}

	function assignBMPCost() {
		if (document.getElementById("selected_subbasins").options.length == 0) {
			alert("Select Subbasins for BMP");
			return;
		}

		if (document.getElementById("selected_bmps").value == "default") {
			alert("Select a BMP for assigning cost");
			return;
		}

		var bmp_cost = document.getElementById("bmp_cost").value;
		if (!isNaN(bmp_cost)) {
			if (bmp_cost == 0) {
				alert("Enter a cost greater than 0");
				return;
			}
			document.getElementById("selected_bmps").options[document
					.getElementById("selected_bmps").selectedIndex].value = bmp_cost;
			alert(bmp_cost
					+ " USD per hectare assigned for "
					+ document.getElementById("selected_bmps").options[document
							.getElementById("selected_bmps").selectedIndex].text);
		} else {
			alert("Enter a valid cost");
			return;
		}
	}

	function displayCost() {
		if (document.getElementById("selected_bmps").value == "default") {
			document.getElementById("bmp_cost").value = "";
			return;
		}
		document.getElementById("bmp_cost").value = document
				.getElementById("selected_bmps").options[document
				.getElementById("selected_bmps").selectedIndex].value;
	}

	function startAgain() {
		$("#main :input").attr("disabled", false); //enable the "main" div element
		document.getElementById("wstype").value = "default";
		displayMap();
	}

	//validation check: if cost is entered for a selected bmp, when user submits for evaluation
	function checkCost() {
		var bmp = new Array();
		var bmp_cost = new Array();
		var i;

		for (i = 1; i < document.getElementById("selected_bmps").options.length; i++) {
			bmp_cost[i] = document.getElementById("selected_bmps").options[i].value;
			//alert(bmp_cost[i]);
		}

		//initialize BMPs to 0: 0 implies bmp is not selected
		bmp[1] = 0; //SB
		bmp[2] = 0; //GW
		bmp[3] = 0; //CW
		//if bmp is selected by the user, the mark it in the array bmp[i]
		for (i = 0; i < document.getElementById("selected_subbasin_bmp").options.length; i++) {
			var j;
			var val = (document.getElementById("selected_subbasin_bmp").options[i].value)
					.split(";");
			for (j = 0; j < val.length; j++) {
				switch (val[j].substring(val[j].indexOf(",") + 1)) {
				case "1"://SB
					bmp[1] = "1";
					if (bmp_cost[1] == "0") {
						alert("Enter a cost for Stream Buffer!");
						return 0;
					}
					break;
				case "2"://GW
					bmp[2] = "2";
					if (bmp_cost[2] == "0") {
						alert("Enter a cost for Grassed Waterways!");
						return 0;
					}
					break;
				case "3"://CW
					bmp[3] = "3";
					if (bmp_cost[3] == "0") {
						alert("Enter a cost for Constructed Wetlands!");
						return 0;
					}
					break;
				}
			}
			//if all bmps are set and cost is entered, then just exit the loop
			if (bmp[1] == "0" || bmp[2] == "0" || bmp[3] == "0")
				continue;
			else
				break;
		}

		return 1;
	}

	$(document).ready(function() {
		$("#evaluate").click(function() {
			//check if any bmp is added
			/*if(document.getElementById("selected_subbasins").options.length == 0){
				alert("No BMPs added for evaluation");
				return;
			}
			
			//check if cost is entered for a selected bmp
			if(checkCost() == "0"){
				return;
			}*/

			alert("Evaluate clicked");
			$("#main :input").attr("disabled", true);
			//return;
			$.post("/run", {
				is_single_simulation : "1",
				simulationType : "1",
				wshIndex : "0", //0:BD , 1:BLC
				listHruBMP : "0,1,2", //HRUID,BMP (BMP codes: 1->SB , 2-> GW, 3->CW)
				cost : "200,0,300" //SB cost,GW cost,CW cost
			})
			.done(function(data) {//callback function for handling response for POST request
				alert("Data: " + data + "\nStatus: " + status);
			})
			.fail(function(data) {
				alert(data);
			});//post ends here
		});//click function ends here
	});//document ready function ends here
</script>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=7,IE=9">
<meta name="viewport"
	content="initial-scale=1, maximum-scale=1,user-scalable=no">
<title>Best Management Practice - Estimation</title>
<link rel="stylesheet"
	href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.3/js/esri/css/esri.css">
<style>
html,body,#map {
	height: 100%;
	width: 100%;
	margin: 0;
	padding: 0;
}

#map {
	display: inline-block;
	overflow: hidden;
}
</style>
</head>

<body>
	<div>
		<h2 align="center">Decision Support System for BMP Evaluation</h2>
	</div>

	<div id="main">
		<table border="1" width="100%">
			<tr>
				<td>Select Watershed <select id="wstype"
					onchange="displayMap()">
						<option value="default">---Select---</option>
						<option value="bd">Big Ditch</option>
						<option value="blc">Big-Long Creek</option>
				</select> Select Subbasin <select id="subbasin_id" onchange="displayHruIDs()">
						<option value="default">-----</option>
				</select> Select BMP <select id="bmp">
						<option value="default">----</option>
						<option value="1">Stream Buffer (SB)</option>
						<option value="2">Grassed Waterways (GW)</option>
						<option value="3">Constructed Wetland (CW)</option>
				</select>
				</td>
			</tr>
			<tr>
				<td>Agricultural HRUs in selected Subbasin
					<div id="hru_info"></div>
					<div>
						<p></p>
					</div>
					<div align="center">
						<button type="button" onclick="assignBMP()">Assign BMP
							for HRU</button>
						<button type="button" onclick="clearBMP()">Clear BMPs</button>
						<button type="button" onclick="addSubbasinForBMP()">Submit</button>
					</div>
				</td>
			</tr>
			<tr>
			</tr>
			<tr>
				<td>Selected Subbasins for BMP <select id="selected_subbasins">
				</select>
					<button type="button" onclick="removeSubbasinForBMP()">Remove
						BMP</button> Cost per hectare for BMP (USD) <select id="selected_bmps"
					onchange="displayCost()">
						<option value="default">----</option>
						<option value="0">Stream Buffer</option>
						<option value="0">Grassed Waterways</option>
						<option value="0">Constructed Wetland</option>
				</select> <input type="text" id="bmp_cost">
					<button type="button" onclick="assignBMPCost()">Assign
						Cost</button> <select id="selected_subbasin_temp" style="display: none"></select>
					<!---<select id="selected_subbasin_hruIDs"></select>
						<select id="selected_subbasin_hruID_bmp"></select>--> <select
					id="selected_subbasin_bmp"></select> <select id="hruIDs_temp"></select>
				</td>
			</tr>
			<tr>
				<td align="center">
					<button type="button" id="evaluate">Evaluate</button>
				</td>
			</tr>
		</table>
	</div>
	<table width="100%">
		<tr>
			<td align="center">
				<button type="button" onclick="startAgain()">Start Again</button>
			</td>
		</tr>
	</table>
	<div id="map"></div>
	<!---<table border="1" width="100%" style="height: 100%;">
			<tr>
				<td width="50%">
						
				</td>
				<td width="50%">
					<p> Graph with pareto optimal data </p>
				</td>
			</tr>
		</table>--->

</body>

</html>
</html>